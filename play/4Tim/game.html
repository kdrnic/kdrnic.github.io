<!--
MIT License

Copyright (c) 2012 kdrnic ( website: kdrnic.xyz )

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<html>
	<head>
		<script>
var state; // 0 - Hasn't started yet; 1 - Start new game; 2 - Playng; 3 - Game over
var context;
var frame;
var stars = new Array(50);
var copter = {};
var scrollX = 0;
var house = new Array(4);
var people = new Array(64);
var tank = new Array(4);
var aliveTanks = 0;
var tankIndex = 0;
var plane = {};
var balloon = {};
var pressed = {};
var rescuedPeople = 0;
var peopleAboard = 0;
var deadPeople = 0;
var peopleOnGround = 0;
var lives = 0;
var copterBullets = Array(50);
var cBIndex = 0;
var particle = Array(200);
var pIndex = 0;
var bomb = {};
var gameOverFrame = -1;
var wasSPressed = false;
var missile = {};
var gameOverCause = 0;
var finalRescueFrame = -1;

function KeyDownEvent(event)
{
	pressed[event.keyCode] = true;
	event.preventDefault();
}

function KeyUpEvent(event)
{
	pressed[event.keyCode] = false;
}

function Start()
{
	window.addEventListener("keyup", function(event){KeyUpEvent(event)});
	window.addEventListener("keydown", function(event){KeyDownEvent(event)});
	state = 0;
	context = document.getElementById("screenCanvas").getContext("2d");
	frame = 0;
	copter.x = 0;
	copter.y = 0;
	copter.angle = 0;
	copter.facing = 0;
	copter.speedX = 0;
	copter.shootDownFrame = -999;
	copter.rotorSpeed = 0;
	plane.x = 0;
	plane.y = 0;
	plane.alive = 0;
	plane.goRight = false;
	plane.useMissile = false;
	balloon.x = 0;
	balloon.y = 0;
	balloon.alive = false;
	balloon.speedX = 0;
	balloon.speedY = 0;
	bomb.x = 0;
	bomb.y = 0;
	bomb.dx = 0;
	bomb.dy = 0;
	bomb.ready = false;
	missile.x = 0;
	missile.y = 0;
	missile.goRight = false;
	missile.speed = 0;
	missile.alive = false;
	for(var i = 0; i < 50; i++)
	{
		stars[i] = {};
		stars[i].x = Math.floor(Math.random() * 640);
		stars[i].y = Math.floor(Math.random() * 340);
		var grayscale = Math.floor(Math.random() * 256);
		stars[i].color = "rgb(" + grayscale + ", " + grayscale + ", " + grayscale + ")";
	}
	for(var i = 0; i < 4; i++)
	{
		house[i] = {};
		house[i].x = 320 + 640 * i;
		
		tank[i] = {};
		tank[i].x = 0;
		tank[i].alive = false;
		tank[i].gunAngle = 0;
		tank[i].speed = 0;
		tank[i].goRight = false;
	}
	for(var i = 0; i < 64; i++)
	{
		people[i] = {};
		people[i].x = 0;
		people[i].state = 0;
		people[i].goRight = false;
	}
	for(var i = 0; i < 50; i++)
	{
		copterBullets[i] = {};
		copterBullets[i].alive = false;
		copterBullets[i].x = 0;
		copterBullets[i].y = 0;
		copterBullets[i].angle = 0;
		copterBullets[i].dx = 0;
		copterBullets[i].dy = 0;
	}
	for(var i = 0; i < 200; i++)
	{
		particle[i] = {};
		particle[i].deathFrame = 0;
	}
	cBIndex = 0;
	setTimeout("DoFrame()", 1000.0 / 60.0);
}

function DoFrame()
{
	Update();
	Draw();
	frame++;
	setTimeout("DoFrame()", 1000.0 / 60.0);
}

function CanvasClick()
{
	if(state == 0) state = 1;
}

function CreateTank()
{
	if(copter.x > 3840) return;
	tank[tankIndex].alive = true;
	tank[tankIndex].speed = 0;
	if(Math.random() > 0.5)
	{
		tank[tankIndex].x = copter.x - 650;
		tank[tankIndex].goRight = true;
	}
	else
	{
		tank[tankIndex].x = copter.x + 650;
		tank[tankIndex].goRight = false;
		tank[tankIndex].speed = 0;
	}
	aliveTanks++;
	tankIndex++;
	if(tankIndex == 4) tankIndex = 0;
}

function OpenHouse(h)
{
	var peopleOutside = deadPeople + rescuedPeople;
	var antiI = Math.floor(peopleOutside / 16);
	if(h == 3 - antiI)
	{
		if(!house[h].open) CreateExplosion(house[h].x, 320, 25, "#FF8888");
		house[h].open = true;
	}
}

function CreateExplosion(x, y, radius, color)
{
	var numP = 0.15 * radius * radius;
	for(var i = 0; i < numP; i++)
	{
		var a = Math.random() * Math.PI * 2;
		var r = radius * Math.sqrt(Math.random());
		var s = (r * 2) / 30;
		particle[pIndex].deathFrame = frame + 30;
		particle[pIndex].x = x + Math.cos(a) * r;
		particle[pIndex].y = y + Math.sin(a) * r;
		particle[pIndex].dx = s * Math.cos(a);
		particle[pIndex].dy = s * Math.sin(a);
		particle[pIndex].color = color;
		pIndex++;
		if(pIndex == 200) pIndex = 0;
	}
}

function CreateBalloon()
{
	if(copter.x > 3840) return;
	if(!balloon.alive)
	{
		balloon.alive = true;
		balloon.y = 25 + Math.random() * 260;
		if(Math.random() < 0.25) balloon.x = copter.x - 345;
		else balloon.x = copter.x + 345;
	}
}

function CreatePlane()
{
	if(copter.x > 3840) return;
	if(!plane.alive)
	{
		plane.alive = true;
		plane.y = Math.random() * 230;
		if(Math.abs(plane.y - copter.y) < 30)
		{
			if(plane.y < 115) plane.y += 50;
			else plane.y -= 50;
		}
		plane.x = copter.x - 900;
		plane.goRight = true;
	}
}

function Update()
{
	if(state == 1)
	{
		lives = 2;
		finalRescueFrame = -1;
		copter.x = 4160;
		copter.y = 324;
		copter.shootDownFrame = -999;
		aliveTanks = 0;
		tankIndex = 0;
		bomb.ready = true;
		for(var i = 0; i < 4; i++)
		{
			house[i].open = false;
			tank[i].x = 0;
			tank[i].alive = false;
			tank[i].gunAngle = 0;
			tank[i].speed = 0;
			tank[i].goRight = false;
		}
		for(var i = 0; i < 64; i++)
		{
			people[i].x = 320 + (640 * Math.floor(i / 16));
			people[i].state = 0; // 0 - Inside house 1 - On the ground 2 - Helicopter 3 - Embassy 4 - Dead 5 - Embassy grounds
			if(Math.random() < 0.5) people[i].goRight = true;
			else people[i].goRight = false;
		}
		plane.alive = false;
		plane.useMissile = false;
		balloon.alive = false;
		missile.alive = false;
		state = 2;
		gameOverFrame = -1;
	}
	else if(state == 2)
	{
		if(copter.shootDownFrame < 0)
		{
			if(pressed[37] && (copter.y < 317))
			{
				if(copter.facing == 0) copter.angle -= 0.05;
				if(copter.facing == 2) copter.angle += 0.05;
				copter.speedX -= 0.25;
			}
			else if(pressed[39] && (copter.y < 317))
			{
				if(copter.facing == 0) copter.angle += 0.05;
				if(copter.facing == 2) copter.angle -= 0.05;
				copter.speedX += 0.25;
			}
			else
			{
				if(copter.angle > 0) copter.angle -= 0.05;
				if(copter.angle < 0) copter.angle += 0.05;
				copter.speedX *= 0.95;
			}
			if(pressed[38])
			{
				if(copter.y > 310) copter.y--;
				else if(copter.y > 300) copter.y -= 2;
				else if(copter.y > 290) copter.y -= 3;
				else copter.y -= 4;
			}
			if(pressed[40])
			{
				if(copter.y > 310) copter.y++;
				else if(copter.y > 300) copter.y += 2;
				else if(copter.y > 290) copter.y += 3;
				else copter.y += 4;
			}
			copter.x += copter.speedX;
			if(copter.angle == 0.04999999999999999) copter.angle = 0.05;
			if(copter.angle > 0.35) copter.angle = 0.35;
			if(copter.angle < -0.35) copter.angle = -0.35;
			if(copter.speedX > 6) copter.speedX = 6;
			if(copter.speedX < -6) copter.speedX = -6;
			if(copter.x < 0) copter.x = 0;
			if(copter.x > 4480) copter.x = 4480;
			if(copter.y > 324) copter.y = 324;
			if(copter.y < 30) copter.y = 30;
			if(pressed[65])
			{
				if(frame % 2 == 0)
				{
					copterBullets[cBIndex].alive = true;
					copterBullets[cBIndex].x = copter.x;
					copterBullets[cBIndex].y = copter.y;
					var a = copter.angle;
					if(copter.facing == 0) a += Math.PI;
					if(copter.facing == 2) a = 0 - a;
					if(a > Math.PI * 2) a -= Math.PI * 2;
					a -= 0.05;
					a += Math.random() * 0.1;
					if(copter.facing == 0) copterBullets[cBIndex].x += Math.cos(a) * 29 - Math.cos(a + Math.PI / 4) * 10;
					if(copter.facing == 0) copterBullets[cBIndex].y += Math.sin(a) * 29 - Math.sin(a + Math.PI / 4) * 10;
					if(copter.facing == 2) copterBullets[cBIndex].x += Math.cos(a) * 29 - Math.cos(a - Math.PI / 4) * 10;
					if(copter.facing == 2) copterBullets[cBIndex].y += Math.sin(a) * 29 - Math.sin(a - Math.PI / 4) * 10;
					copterBullets[cBIndex].angle = a;
					copterBullets[cBIndex].dx = Math.cos(a) * 10 + copter.speedX;
					copterBullets[cBIndex].dy = Math.sin(a) * 10;
					cBIndex++;
					if(cBIndex == 50) cBIndex = 0;
				}
			}
			if(pressed[68])
			{
				if(bomb.ready)
				{
					bomb.ready = false;
					bomb.x = copter.x;
					bomb.y = copter.y + 20;
					bomb.dx = copter.speedX;
					bomb.dy = 0;
				}
			}
			if(copter.y < 310) copter.rotorSpeed = 0.1;
			else copter.rotorSpeed = 0.05;
			if(pressed[83])
			{
				if(!wasSPressed)
				{
					if(copter.facing == 2) copter.facing = 0;
					else copter.facing = 2;
					copter.angle = 0 - copter.angle;
				}
				wasSPressed = true;
			}
			else wasSPressed = false;
		}
		else
		{
			if(frame == copter.shootDownFrame + 1)
			{
				CreateExplosion(copter.x, copter.y, 25, "#BBBBBB");
				for(var i = 0; i < 64; i++)
				{
					if(people[i].state == 2) people[i].state = 4;
				}
			}
			copter.rotorSpeed = 0;
			copter.angle -= 0.1;
			if(copter.angle < (0 - Math.PI) * 0.5) copter.angle = (0 - Math.PI) * 0.5;
			var oldY = copter.y;
			copter.y += (frame - copter.shootDownFrame) * 0.5;
			if(copter.y > 324)
			{
				copter.y = 324;
				if(oldY < 324) CreateExplosion(copter.x, copter.y, 25, "#BBBBBB");
			}
			if(frame - copter.shootDownFrame > 240)
			{
				if(lives > 0)
				{
					lives--;
					copter.x = 4160;
					copter.y = 324;
					copter.shootDownFrame = -1;
					copter.angle = 0;
				}
				else
				{
					gameOverCause = 1;
					state = 3;
				}
			}
		}
		
		for(var i = 0; i < 4; i++)
		{
			if(tank[i].alive == false) continue;
			if(tank[i].goRight) tank[i].speed += 0.25;
			else tank[i].speed -= 0.25;
			if(tank[i].speed > 4) tank[i].speed = 4;
			if(tank[i].speed < -4) tank[i].speed = -4;
			tank[i].x += tank[i].speed;
			if((tank[i].x - copter.x > 0) & (Math.random() < 0.025)) tank[i].goRight = false;
			if((copter.x - tank[i].x > 0) & (Math.random() < 0.025)) tank[i].goRight = true;
			var theta = Math.atan2(copter.y - 345, copter.x - tank[i].x);
			if(theta < 0) theta += 2 * Math.PI;
			tank[i].gunAngle = theta;
			if(tank[i].x - copter.x > 900)
			{
				tank[i].alive = false;
				aliveTanks--;
			}
			if(copter.x - tank[i].x > 900)
			{
				tank[i].alive = false;
				aliveTanks--;
			}
			if((!bomb.ready) && (bomb.y > 350) && (Math.abs(tank[i].x - bomb.x) < 45) && (tank[i].alive))
			{
				CreateExplosion(tank[i].x, 355, 50, "rgb(0,64,0)");
				tank[i].alive = false;
				aliveTanks--;
				bomb.ready = true;
			}
		}
		
		if(!bomb.ready)
		{
			bomb.x += bomb.dx;
			bomb.y += bomb.dy;
			bomb.dy += 0.5;
			if(bomb.y > 350 + 12 + 6 + 6)
			{
				bomb.ready = true;
				CreateExplosion(bomb.x, 350 + 12 + 6 + 6, 23, "rgb(165,32,48)");
			}
		}
		
		if(plane.alive)
		{
			if(plane.goRight) plane.x += 9;
			else plane.x -= 9;
			if(plane.x - copter.x > 900)
			{
				plane.goRight = false;
				plane.y = Math.random() * 230;
				if(Math.abs(plane.y - copter.y) < 30)
				{
					if(plane.y < 115) plane.y += 50;
					else plane.y -= 50;
				}
			}
			if(copter.x - plane.x > 900)
			{
				plane.goRight = true;
				plane.y = Math.random() * 230;
			}
			if((Math.abs(plane.x - copter.x) < 80) && (Math.abs(plane.y - copter.y) < 30))
			{
				CreateExplosion(plane.x, plane.y, 20, "#448888");
				if(copter.shootDownFrame < 0) copter.shootDownFrame = frame;
				plane.alive = false;
			}
			
			if(plane.useMissile)
			{
				if(plane.goRight && (copter.x - plane.x >= 200) && (missile.alive == false))
				{
					missile.alive = true;
					missile.x = plane.x - 6;
					missile.y = plane.y;
					missile.speed = 9;
					missile.goRight = true;
				}
				if((!plane.goRight) && (plane.x - copter.x >= 200) && (missile.alive == false))
				{
					missile.alive = true;
					missile.x = plane.x + 6;
					missile.y = plane.y;
					missile.speed = 9;
					missile.goRight = false;
				}
			}
		}
		
		if(missile.alive)
		{
			if(missile.goRight) missile.x += missile.speed;
			else missile.x -= missile.speed;
			if(copter.y > missile.y) missile.y += 2;
			if(copter.y < missile.y) missile.y -= 2;
			missile.speed += 0.3;
			
			if(missile.x - scrollX < 0 - 100) missile.alive = false;
			if(missile.x - scrollX > 740) missile.alive = false;
			
			if((Math.abs(missile.x - copter.x) < 40) && (Math.abs(missile.y - copter.y) < 14))
			{
				CreateExplosion(missile.x, missile.y, 20, "rgb(255,128,0)");
				if(copter.shootDownFrame < 0) copter.shootDownFrame = frame;
				missile.alive = false;
			}
			
			particle[pIndex].deathFrame = frame + 20;
			if(missile.goRight) particle[pIndex].x = missile.x - 33;
			else particle[pIndex].x = missile.x + 33;
			particle[pIndex].y = missile.y;
			if(missile.goRight) particle[pIndex].dx = 0 - missile.speed * 0.25;
			else particle[pIndex].dx = 0 + missile.speed * 0.25;
			particle[pIndex].dy = (Math.random() * 2) - 4;
			particle[pIndex].color = "rgb(255,128,0)";
			pIndex++;
			if(pIndex == 200) pIndex = 0;
		}
		
		if(balloon.alive)
		{
			if(copter.x > balloon.x) balloon.speedX += 0.20;
			if(copter.x < balloon.x) balloon.speedX -= 0.20;
			if(copter.y > balloon.y) balloon.speedY += 0.20;
			if(copter.y < balloon.y) balloon.speedY -= 0.20;
			if(balloon.speedX > 3) balloon.speedX = 3;
			if(balloon.speedX < -3) balloon.speedX = -3;
			if(balloon.speedY > 3) balloon.speedY = 3;
			if(balloon.speedY < -3) balloon.speedY = -3;
			balloon.x += balloon.speedX;
			balloon.y += balloon.speedY;
			if(balloon.x - copter.x > 1200) balloon.alive = false;
			if(copter.x - balloon.x > 1200) balloon.alive = false;
			if((balloon.x - copter.x) * (balloon.x - copter.x) + (balloon.y - copter.y) * (balloon.y - copter.y) < 2025)
			{
				balloon.alive = false;
				CreateExplosion(balloon.x, balloon.y, 20, "#BBBB55");
				if(copter.shootDownFrame < 0) copter.shootDownFrame = frame;
			}
		}
		
		rescuedPeople = 0;
		peopleAboard = 0;
		deadPeople = 0;
		peopleOnGround = 0;
		var canLeave = true;
		for(var i = 0; i < 64; i++)
		{
			if(people[i].state == 0)
			{
				if(house[Math.floor(i / 16)].open)
				{
					people[i].state = 1;
					people[i].goRight = (Math.random() < 0.5);
				}
				continue;
			}
			if(people[i].state == 1)
			{
				peopleOnGround++;
				if((copter.y == 324) && (Math.abs(copter.x - people[i].x) < 700) && (copter.shootDownFrame < 0))
				{
					if(Math.abs(people[i].x - copter.x + 9) > 1)
					{
						if(frame % 90 == 1)
						{
							if(copter.x - 9 < people[i].x) people[i].goRight = false;
							if(copter.x - 9 >= people[i].x) people[i].goRight = true;
						}
					}
					else people[i].state = 2;
				}
				else
				{
					if(Math.random() < 0.05)
					{
						people[i].goRight = !people[i].goRight;
					}
					if(people[i].x < house[Math.floor(i / 16)].x - 320) people[i].goRight = true;
					if(people[i].x > house[Math.floor(i / 16)].x + 320) people[i].goRight = false;
				}
				if(people[i].goRight) people[i].x++;
				else people[i].x--;
				continue;
			}
			if(people[i].state == 2)
			{
				peopleAboard++;
				if(copter.y == 324)
				{
					if((copter.x + 40 > 4100) && (copter.x - 40 < 4210) && (copter.shootDownFrame < 0))
					{
						if(frame % 45 == 0)
						{
							if(canLeave)
							{
								if(copter.facing == 0) people[i].x = copter.x - 9;
								else people[i].x = copter.x + 9;
								people[i].state = 5;
								canLeave = false;
							}
						}
					}
				}
				continue;
			}
			if(people[i].state == 3)
			{
				rescuedPeople++;
				continue;
			}
			if(people[i].state == 4)
			{
				deadPeople++;
				continue;
			}
			if(people[i].state == 5)
			{
				if(Math.abs(people[i].x - 4160) > 1)
				{
					if(4160 < people[i].x) people[i].goRight = false;
					if(4160 >= people[i].x) people[i].goRight = true;
				}
				else people[i].state = 3;
				if(people[i].goRight) people[i].x++;
				else people[i].x--;
				continue;
			}
		}
		
		for(var i = 0; i < 50; i++)
		{
			for(var k = 0; k < 3; k++)
			{
				if(copterBullets[i].alive == true)
				{
					copterBullets[i].x += copterBullets[i].dx * 0.333;
					copterBullets[i].y += copterBullets[i].dy * 0.333;
					if(copterBullets[i].y > 315)
					{
						for(var j = 0; j < 64; j++)
						{
							if(people[j].state == 1)
							{
								if(Math.abs(people[j].x - copterBullets[i].x) < 5)
								{
									people[j].state = 4;
									copterBullets[i].alive = false;
									CreateExplosion(people[j].x, 330, 10, "#880000");
									break;
								}
							}
						}
					}
					if(copterBullets[i].y > 340)
					{
						for(var j = 0; j < 4; j++)
						{
							if(Math.abs(house[j].x - copterBullets[i].x) < 38)
							{
								setTimeout("OpenHouse("+j+")",500);
							}
						}
						copterBullets[i].alive = false;
					}
					if(((balloon.x - copterBullets[i].x) * (balloon.x - copterBullets[i].x) + (balloon.y - copterBullets[i].y) * (balloon.y - copterBullets[i].y) < 625) && (balloon.alive))
					{
						balloon.alive = false;
						copterBullets[i].alive = false;
						CreateExplosion(balloon.x, balloon.y, 20, "#BBBB55");
					}
					if((Math.abs(plane.x - copterBullets[i].x) < 50) && (Math.abs(plane.y - copterBullets[i].y) < 10) && (plane.alive))
					{
						plane.alive = false;
						copterBullets[i].alive = false;
						CreateExplosion(plane.x, plane.y, 20, "#448888");
					}
					if(Math.abs(copterBullets[i].x - copter.x) > 330) copterBullets[i].alive = false;
				}
			}
		}
		
		for(var i = 0; i < 200; i++)
		{
			if(particle[i].deathFrame > frame)
			{
				particle[i].x += particle[i].dx;
				particle[i].y += particle[i].dy;
			}
		}
		
		var b = deadPeople + rescuedPeople;
		a = Math.floor(b / 16);
		if(aliveTanks < a + 1)
		{
			if(frame % 180 == 0) CreateTank();
		}
		if(a >= 1)
		{
			if(frame % 360 == 90) CreateBalloon();
		}
		if(a >= 2)
		{
			if(frame % 360 == 270) CreatePlane();
		}
		if(a >= 3)
		{
			plane.useMissile = true;
		}
		if(b == 64)
		{
			plane.alive = false;
			tank[0].alive = false;
			tank[1].alive = false;
			tank[2].alive = false;
			tank[3].alive = false;
			balloon.alive = false;
			missile.alive = false;
			if(finalRescueFrame < 0) finalRescueFrame = frame;
			if((frame % 30 == 0) && (rescuedPeople == 64))
			{
				var r = Math.random();
				if(r < 0.333) CreateExplosion(3840 + 640 * Math.random(), 300 * Math.random(), 25, "#FF0000");
				else if(r < 0.666) CreateExplosion(3840 + 640 * Math.random(), 300 * Math.random(), 25, "#00FF00");
				else CreateExplosion(3840 + 640 * Math.random(), 300 * Math.random(), 25, "#0000FF");
			}
			if((frame - finalRescueFrame >= 180) && (rescuedPeople != 64))
			{
				gameOverCause = 2;
				state = 3;
			}
			if((frame - finalRescueFrame >= 360) && (rescuedPeople == 64))
			{
				gameOverCause = 3;
				state = 3;
			}
		}
		
		scrollX = copter.x - 320;
		if(copter.x < 320) scrollX = 0;
		if(copter.x > 4160) scrollX = 3840;
	}
	else if(state == 3)
	{
		if(gameOverFrame < 0) gameOverFrame = frame;
		if(frame - gameOverFrame > 300) state = 0;
	}
}

function DrawSky()
{
	context.fillStyle = "#000000";
	context.fillRect(0, 0, 640, 340);
	for(var i = 0; i < 50; i++)
	{
		if(Math.random() < 0.015)
		{
			var grayscale = Math.floor(Math.random() * 256);
			stars[i].color = "rgb(" + grayscale + ", " + grayscale + ", " + grayscale + ")";
		}
		context.beginPath();
		context.strokeStyle = stars[i].color;
		context.moveTo(stars[i].x - 2, stars[i].y);
		context.lineTo(stars[i].x + 2, stars[i].y);
		context.moveTo(stars[i].x, stars[i].y - 2);
		context.lineTo(stars[i].x, stars[i].y + 2);
		context.stroke();
		context.closePath();		
	}
}

function DrawGround()
{
	var gradient = context.createLinearGradient(0, 340, 0, 400);
	gradient.addColorStop(0, "rgb(0, 128, 0)");
	gradient.addColorStop(1, "rgb(14, 64, 14)");
	context.fillStyle = gradient;
	context.fillRect(0, 340, 640, 400);
}

function DrawMountain()
{
	var mountainX = Math.floor(((3840 - scrollX) / 3840) * 440);
	if(mountainX == "NaN") return;
	var gradient = context.createLinearGradient(0, 277, 0, 340);
	gradient.addColorStop(0, "rgb(192, 192, 192)");
	gradient.addColorStop(1, "rgb(128, 128, 128)");
	context.fillStyle = gradient;
	context.beginPath();
	context.moveTo(mountainX, 340);
	context.lineTo(mountainX + 26, 312);
	context.lineTo(mountainX + 60, 330);
	context.lineTo(mountainX + 102, 277);
	context.lineTo(mountainX + 133, 317);
	context.lineTo(mountainX + 199, 340);
	context.closePath();
	context.fill();
}

function DrawBuildings()
{
	for(var i = 0; i < 4; i++)
	{
		var houseX = house[i].x;
		if((scrollX < houseX + 38) && (scrollX + 640 > houseX - 38))
		{
			context.moveTo(0, 0);
			context.fillStyle = "#FF0000";
			context.beginPath();
			context.moveTo(houseX - 38 - scrollX, 340);
			context.lineTo(houseX - 38 - scrollX, 310);
			context.lineTo(houseX + 38 - scrollX, 310);
			context.lineTo(houseX + 38 - scrollX, 340);
			context.closePath();
			context.fill();
			context.beginPath();
			context.moveTo(houseX - 38 - scrollX, 310);
			context.lineTo(houseX - scrollX, 300);
			context.lineTo(houseX + 38 - scrollX, 310);
			context.closePath();
			context.fillStyle = "#000000";
			context.strokeStyle = "#FFFFFF";
			context.fill();
			context.stroke();
			if(house[i].open)
			{
				context.beginPath();
				context.moveTo(houseX - 15 - 5 - scrollX, 340);
				context.lineTo(houseX - 5 - scrollX, 315);
				context.lineTo(houseX + 17 - 5 - scrollX, 323);
				context.lineTo(houseX + 21 - 5 - scrollX, 340);
				context.closePath();
				context.fill();
			}
		}
	}
	if((scrollX < 4160 + 38) && (scrollX + 640 > 4160 - 38))
	{
		context.moveTo(0, 0);
		context.fillStyle = "#FF0000";
		context.beginPath();
		context.moveTo(4160 - 38 - scrollX, 340);
		context.lineTo(4160 - 38 - scrollX, 310);
		context.lineTo(4160 + 38 - scrollX, 310);
		context.lineTo(4160 + 38 - scrollX, 340);
		context.closePath();
		context.fill();
		context.beginPath();
		context.moveTo(4160 - 38 - scrollX, 310);
		context.lineTo(4160 - scrollX, 300);
		context.lineTo(4160 + 38 - scrollX, 310);
		context.closePath();
		context.fillStyle = "#000000";
		context.strokeStyle = "#FFFFFF";
		context.fill();
		context.stroke();
		context.beginPath();
		context.moveTo(4160 - scrollX, 300);
		context.lineTo(4160 - scrollX, 260);
		context.lineTo(4160 + 25 - scrollX, 260);
		context.lineTo(4160 + 25 - scrollX, 275);
		context.lineTo(4160 - scrollX, 275);
		context.closePath();
		context.fill();
		context.stroke();		
		context.beginPath();
		context.moveTo(4160 - 38 - scrollX, 340);
		context.lineTo(4160 - 38 - 24 - scrollX, 364);
		context.lineTo(4160 + 38 + 24 - scrollX, 364);
		context.lineTo(4160 + 38 - scrollX, 340);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.moveTo(4160 - 10 - scrollX, 342);
		context.lineTo(4160 - 10 - scrollX, 362);
		context.lineTo(4160 - 5 - scrollX, 362);
		context.lineTo(4160 - 5 - scrollX, 352);
		context.lineTo(4160 + 5 - scrollX, 352);
		context.lineTo(4160 + 5 - scrollX, 362);
		context.lineTo(4160 + 10 - scrollX, 362);
		context.lineTo(4160 + 10 - scrollX, 342);
		context.lineTo(4160 + 5 - scrollX, 342);
		context.lineTo(4160 + 5 - scrollX, 347);
		context.lineTo(4160 - 5 - scrollX, 347);
		context.lineTo(4160 - 5 - scrollX, 342);
		context.closePath();
		context.stroke();
	}
}

function DrawPeople()
{
	for(var i = 0; i < 64; i++)
	{
		if((people[i].state != 1) && (people[i].state != 5)) continue;
		var peopleX = people[i].x - scrollX;
		if((peopleX > -10) && (peopleX < 650))
		{
			var animFrame = Math.floor((frame % 60) / 5) % 4;
			context.save();
			context.translate(peopleX, 0);
			if(people[i].goRight == false) context.scale(-1, 1);
			if(animFrame == 0)
			{
				context.strokeStyle = "#FFFFFF";
				context.beginPath();
				context.moveTo(0 - 6, 340 - 9);
				context.lineTo(0 - 4, 340 - 10);
				context.lineTo(0 - 3, 340 - 6);
				context.lineTo(0 + 2, 340 - 10);
				context.lineTo(0 + 1, 340 - 17);
				context.lineTo(0 - 4, 340 - 15);
				context.lineTo(0 - 2, 340 - 12);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 17);
				context.lineTo(0 + 5, 340 - 14);
				context.lineTo(0 + 7, 340 - 18);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 2, 340 - 10);
				context.lineTo(0 + 5, 340 - 9);
				context.lineTo(0 - 2, 340 - 3);
				context.lineTo(0 + 2, 340 - 2);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.arc(0 + 2, 340 - 19, 2, 2 * Math.PI, false);
				context.closePath();
				context.stroke();
			}
			if(animFrame == 1)
			{
				context.strokeStyle = "#FFFFFF";
				context.beginPath();
				context.moveTo(0 - 4, 340 - 3);
				context.lineTo(0 - 4, 340 - 5);
				context.lineTo(0 + 1, 340 - 9);
				context.lineTo(0 + 1, 340 - 18);
				context.lineTo(0 - 2, 340 - 13);
				context.lineTo(0 + 2, 340 - 12);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 18);
				context.lineTo(0 + 4, 340 - 13);
				context.lineTo(0 + 7, 340 - 15);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 9);
				context.lineTo(0 + 3, 340 - 7);
				context.lineTo(0 - 2, 340 - 3);
				context.lineTo(0 + 2, 340 - 2);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.arc(0 + 2, 340 - 19, 2, 2 * Math.PI, false);
				context.closePath();
				context.stroke();
			}
			if(animFrame == 2)
			{
				context.strokeStyle = "#FFFFFF";
				context.beginPath();
				context.moveTo(0 + 1, 340 - 2);
				context.lineTo(0 - 3, 340 - 3);
				context.lineTo(0 + 1, 340 - 6);
				context.lineTo(0 + 1, 340 - 13);
				context.lineTo(0 + 2, 340 - 18);
				context.lineTo(0 - 3, 340 - 14);
				context.lineTo(0 + 1, 340 - 11);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 2, 340 - 18);
				context.lineTo(0 + 6, 340 - 15);
				context.lineTo(0 + 8, 340 - 17);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 13);
				context.lineTo(0 + 4, 340 - 11);
				context.lineTo(0 - 2, 340 - 7);
				context.lineTo(0 + 1, 340 - 6);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.arc(0 + 2, 340 - 19, 2, 2 * Math.PI, false);
				context.closePath();
				context.stroke();
			}
			if(animFrame == 3)
			{
				context.strokeStyle = "#FFFFFF";
				context.beginPath();
				context.moveTo(0 - 7, 340 - 2);
				context.lineTo(0 - 7, 340 - 4);
				context.lineTo(0 - 2, 340 - 7);
				context.lineTo(0 + 1, 340 - 12);
				context.lineTo(0 + 1, 340 - 17);
				context.lineTo(0 - 4, 340 - 18);
				context.lineTo(0 - 6, 340 - 14);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 17);
				context.lineTo(0 + 4, 340 - 15);
				context.lineTo(0 + 6, 340 - 18);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.moveTo(0 + 1, 340 - 12);
				context.lineTo(0 + 6, 340 - 11);
				context.lineTo(0 + 7, 340 - 4);
				context.lineTo(0 + 9, 340 - 4);
				context.stroke();
				context.closePath();
				context.beginPath();
				context.arc(0 + 2, 340 - 19, 2, 2 * Math.PI, false);
				context.closePath();
				context.stroke();
			}
			context.restore();
		}
	}
}

function DrawTanks()
{
	for(var i = 0; i < 4; i++)
	{
		var tankX = 0;
		tankX = tank[i].x - scrollX;
		if(tankX < 0 - 25 - 12 - 6) continue;
		if(tankX > 640 + 25 + 12 + 6) continue;
		if(tank[i].alive == false) continue;
		context.strokeStyle = "rgb(0, 128, 0)";
		var gradient5 = context.createLinearGradient(tankX - Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 3, 345 - Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2, tankX + Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 2, 345 + Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2);
		gradient5.addColorStop(0, "rgb(48, 48, 48)");
		gradient5.addColorStop(0.5, "rgb(128, 128, 128)");
		gradient5.addColorStop(1, "rgb(48, 48, 48)");
		context.fillStyle = gradient5;
		context.beginPath();
		context.moveTo(tankX - Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 2, 345 - Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2);
		context.lineTo(tankX + Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 2, 345 + Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2);
		context.lineTo(tankX + Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 2 + Math.cos(tank[i].gunAngle) * 20, 345 + Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2 + Math.sin(tank[i].gunAngle) * 20);
		context.lineTo(tankX - Math.cos(tank[i].gunAngle - Math.PI * 0.5) * 2 + Math.cos(tank[i].gunAngle) * 20, 345 - Math.sin(tank[i].gunAngle - Math.PI * 0.5) * 2 + Math.sin(tank[i].gunAngle) * 20);
		context.closePath();
		context.fill();
		var gradient = context.createLinearGradient(tankX - 25, 350, tankX + 25 + 12, 350 + 12);
		gradient.addColorStop(0, "rgb(0, 64, 0)");
		gradient.addColorStop(0.5, "rgb(0, 96, 0)");
		gradient.addColorStop(1, "rgb(0, 64, 0)");
		context.fillStyle = gradient;
		context.beginPath();
		context.moveTo(tankX - 25, 350);
		context.lineTo(tankX - 25 - 12, 350 + 12);
		context.lineTo(tankX + 25 + 12, 350 + 12);
		context.lineTo(tankX + 25, 350);
		context.closePath();
		context.fill();
		context.stroke();
		var gradient2 = context.createLinearGradient(tankX - 10, 340, tankX + 10, 340);
		gradient2.addColorStop(0, "rgb(0, 74, 0)");
		gradient2.addColorStop(0.5, "rgb(0, 106, 0)");
		gradient2.addColorStop(1, "rgb(0, 74, 0)");
		context.fillStyle = gradient2;
		context.beginPath();
		context.moveTo(tankX - 10, 340);
		context.lineTo(tankX + 10, 340);
		context.lineTo(tankX + 10, 350);
		context.lineTo(tankX - 10, 350);
		context.closePath();
		context.fill();
		context.stroke();
		var gradient3 = context.createLinearGradient(tankX - Math.cos(frame * 0.05236) * 23, 350 + 12 + 6 - Math.sin(frame * 0.05236) * 23, tankX + Math.cos(frame * 0.05236) * 40, 350 + 12 + 6 + Math.sin(frame * 0.05236) * 6);
		gradient3.addColorStop(0, "rgb(128, 128, 128)");
		gradient3.addColorStop(0.5, "rgb(192, 192, 192)");
		gradient3.addColorStop(1, "rgb(128, 128, 128)");
		context.fillStyle = gradient3;
		context.beginPath();
		context.moveTo(tankX, 350 + 12);
		context.arc(tankX - 25 - 12, 350 + 12 + 6, 6, Math.PI * 1.5, Math.PI * 0.5, true);
		context.arc(tankX + 25 + 12, 350 + 12 + 6, 6, Math.PI * 0.5, Math.PI * 1.5, true);
		context.closePath();
		context.fill();
		var gradient4 = context.createLinearGradient(tankX - Math.cos(frame * 0.05236) * 23, 350 + 12 + 6 - Math.sin(frame * 0.05236) * 23, tankX + Math.cos(frame * 0.05236) * 40, 350 + 12 + 6 + Math.sin(frame * 0.05236) * 6);
		gradient4.addColorStop(0, "rgb(64, 64, 64)");
		gradient4.addColorStop(0.5, "rgb(96, 96, 96)");
		gradient4.addColorStop(1, "rgb(64, 64, 64)");
		context.fillStyle = gradient4;
		context.beginPath();
		context.moveTo(tankX, 350 + 12 + 2);
		context.arc(tankX - 25 - 12, 350 + 12 + 6, 4, Math.PI * 1.5, Math.PI * 0.5, true);
		context.arc(tankX + 25 + 12, 350 + 12 + 6, 4, Math.PI * 0.5, Math.PI * 1.5, true);
		context.closePath();
		context.fill();
		context.strokeStyle = "#333333";
		context.beginPath();
		context.arc(tankX - 25 - 12, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
		context.beginPath();
		context.arc(tankX - 25 - 12 + 8 + 8 + 8 + 8 + 8 + 8 + 8 + 8 + 8, 350 + 12 + 6, 3, 0, Math.PI * 2);
		context.closePath();
		context.stroke();
	}
}

function DrawPlane()
{
	var planeX = plane.x - scrollX;
	if(planeX < 0 - 60) return;
	if(planeX > 640 + 60) return;
	if(plane.alive == false) return;
	if(plane.goRight)
	{
		var gradient = context.createLinearGradient(planeX, plane.y - 11, planeX, plane.y + 7);
		gradient.addColorStop(0, "rgb(47, 96, 96)");
		gradient.addColorStop(0.5, "rgb(62, 128, 128)");
		gradient.addColorStop(1, "rgb(47, 96, 96)");
		context.fillStyle = gradient;
		context.strokeStyle = "rgb(62, 128, 128)";
		context.beginPath();
		context.moveTo(planeX + 16, plane.y - 11);
		context.lineTo(planeX + 28, plane.y - 11);
		context.lineTo(planeX + 33, plane.y - 8);
		context.lineTo(planeX + 40, plane.y - 8);
		context.lineTo(planeX + 55, plane.y - 4);
		context.lineTo(planeX + 15, plane.y + 1);
		context.lineTo(planeX + 4, plane.y + 7);
		context.lineTo(planeX - 48, plane.y + 7);
		context.lineTo(planeX - 48, plane.y + 1);
		context.lineTo(planeX - 23, plane.y - 4);
		context.closePath();
		context.fill();
		context.stroke();
		var gradient2 = context.createLinearGradient(planeX - 48, plane.y + 1, planeX - 30, plane.y - 6);
		gradient2.addColorStop(0, "rgb(128, 62, 62)");
		gradient2.addColorStop(0.5, "rgb(192, 93, 93)");
		gradient2.addColorStop(1, "rgb(128, 62, 62)");
		context.fillStyle = gradient2;
		context.strokeStyle = "rgb(192, 93, 93)";
		context.beginPath();
		context.moveTo(planeX - 48, plane.y + 1);
		context.lineTo(planeX - 49, plane.y - 15);
		context.lineTo(planeX - 45, plane.y - 17);
		context.lineTo(planeX - 30, plane.y - 6);
		context.lineTo(planeX - 23, plane.y - 4);
		context.closePath();
		context.fill();
	}
	else
	{
		var gradient = context.createLinearGradient(planeX, plane.y - 11, planeX, plane.y + 7);
		gradient.addColorStop(0, "rgb(47, 96, 96)");
		gradient.addColorStop(0.5, "rgb(62, 128, 128)");
		gradient.addColorStop(1, "rgb(47, 96, 96)");
		context.fillStyle = gradient;
		context.strokeStyle = "rgb(62, 128, 128)";
		context.beginPath();
		context.moveTo(planeX - 16, plane.y - 11);
		context.lineTo(planeX - 28, plane.y - 11);
		context.lineTo(planeX - 33, plane.y - 8);
		context.lineTo(planeX - 40, plane.y - 8);
		context.lineTo(planeX - 55, plane.y - 4);
		context.lineTo(planeX - 15, plane.y + 1);
		context.lineTo(planeX - 4, plane.y + 7);
		context.lineTo(planeX + 48, plane.y + 7);
		context.lineTo(planeX + 48, plane.y + 1);
		context.lineTo(planeX + 23, plane.y - 4);
		context.closePath();
		context.fill();
		context.stroke();
		var gradient2 = context.createLinearGradient(planeX + 48, plane.y + 1, planeX + 30, plane.y - 6);
		gradient2.addColorStop(0, "rgb(128, 62, 62)");
		gradient2.addColorStop(0.5, "rgb(192, 93, 93)");
		gradient2.addColorStop(1, "rgb(128, 62, 62)");
		context.fillStyle = gradient2;
		context.strokeStyle = "rgb(192, 93, 93)";
		context.beginPath();
		context.moveTo(planeX + 48, plane.y + 1);
		context.lineTo(planeX + 49, plane.y - 15);
		context.lineTo(planeX + 45, plane.y - 17);
		context.lineTo(planeX + 30, plane.y - 6);
		context.lineTo(planeX + 23, plane.y - 4);
		context.closePath();
		context.fill();
	}
}

function DrawBalloon()
{
	var balloonX = balloon.x - scrollX;
	if(balloonX < 0 - 60) return;
	if(balloonX > 640 + 60) return;
	if(balloon.alive == false) return;
	var gradient = context.createRadialGradient(balloonX, balloon.y, 5, balloonX, balloon.y, 25);
	gradient.addColorStop(0, "rgb(192, 192, 95)");
	gradient.addColorStop(1, "rgb(128, 128, 63)");
	context.fillStyle = gradient;
	context.strokeStyle = "rgb(192, 192, 95)";
	context.beginPath();
	context.arc(balloonX, balloon.y, 25, 0, Math.PI * 2);
	context.closePath();
	context.fill();
	context.stroke();
	context.fillStyle = "rgb(96, 72, 48)";
	context.strokeStyle = "rgb(128, 64, 0)";
	context.beginPath();
	context.moveTo(balloonX - 8, balloon.y + 35);
	context.lineTo(balloonX - 8, balloon.y + 45);
	context.lineTo(balloonX + 8, balloon.y + 45);
	context.lineTo(balloonX + 8, balloon.y + 35);
	context.closePath();
	context.fill();
	context.beginPath();
	context.moveTo(balloonX - 25, balloon.y);
	context.lineTo(balloonX - 8, balloon.y + 35);
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(balloonX + 25, balloon.y);
	context.lineTo(balloonX + 8, balloon.y + 35);
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(balloonX, balloon.y + 5);
	context.lineTo(balloonX, balloon.y + 35);
	context.stroke();
	context.closePath();
}

function DrawCopterBullets()
{
	for(var i = 0; i < 50; i++)
	{
		if(!copterBullets[i].alive) continue;
		context.save();
		context.translate(copterBullets[i].x - scrollX, copterBullets[i].y);
		context.rotate(copterBullets[i].angle);
		context.strokeStyle = "rgb(255, 255, 127)";
		context.beginPath();
		context.moveTo(0 - 5, 0);
		context.lineTo(0 + 5, 0);
		context.stroke();
		context.closePath();
		context.restore();
	}
}

function DrawTankBullets()
{
}

function DrawMissile()
{
	if(!missile.alive) return;
	var missileX = missile.x - scrollX;
	context.save();
	context.translate(missileX, missile.y);
	if(!missile.goRight) context.scale(-1, 1);
	var gradient = context.createLinearGradient(0, 0 - 4, 0, 0 + 4);
	gradient.addColorStop(0, "rgb(255, 59, 59)");
	gradient.addColorStop(0.333, "rgb(195,44,44)");
	gradient.addColorStop(0.334, "rgb(192,192,192)");
	gradient.addColorStop(0.5, "rgb(225,225,225)");
	gradient.addColorStop(0.665, "rgb(192,192,192)");
	gradient.addColorStop(0.666, "rgb(195,44,44)");
	gradient.addColorStop(1, "rgb(255,59,59)");
	var ofs = context.fillStyle;
	context.fillStyle = gradient;
	context.beginPath();
	context.moveTo(0 - 33, -4);
	context.lineTo(0 - 33 + 9, -4);
	context.lineTo(0 - 33 + 9 + 3, -1);
	context.lineTo(0, -1);
	context.lineTo(1, 0);
	context.lineTo(0, 1);
	context.lineTo(0 - 33 + 9 + 3, 1);
	context.lineTo(0 - 33 + 9, 4);
	context.lineTo(0 - 33, 4);
	context.lineTo(0 - 33 + 3, 1);
	context.lineTo(0 - 33 + 3, -1);
	context.closePath();
	context.fill();
	context.restore();
	context.fillStyle = ofs;
}

function DrawCopter()
{
	var copterX = copter.x - scrollX;
	var oldlw = context.lineWidth;
	context.save();
	context.translate(copterX, copter.y);
	if(copter.facing == 2) context.scale(-1, 1);
	context.rotate(copter.angle);
	var gradient = context.createLinearGradient(0, 0 - 16, 0, 0 + 10);
	gradient.addColorStop(0, "rgb(128, 128, 128)");
	gradient.addColorStop(0.3, "rgb(160,160,160)");
	gradient.addColorStop(0.42, "rgb(192,192,192)");
	gradient.addColorStop(0.6, "rgb(208,208,208)");
	gradient.addColorStop(0.8, "rgb(224,224,224)");
	gradient.addColorStop(0.9, "rgb(192,192,192)");
	gradient.addColorStop(1, "rgb(128,128,128)");
	context.fillStyle = gradient;
	context.beginPath();
	context.moveTo(0 - 34, 0 + 10);
	context.lineTo(0 - 40, 0 + 8);
	context.lineTo(0 - 40, 0 + 5);
	context.lineTo(0 - 32, 0 + 1);
	context.lineTo(0 - 28, 0 - 6);
	context.lineTo(0 - 21, 0 - 9);
	context.lineTo(0 - 14, 0 - 9);
	context.lineTo(0 - 10, 0 - 15);
	context.lineTo(0 + 6, 0 - 16);
	context.lineTo(0 + 23, 0 - 10);
	context.lineTo(0 + 50, 0 - 10);
	context.lineTo(0 + 59, 0 - 25);
	context.lineTo(0 + 63, 0 - 24);
	context.lineTo(0 + 57, 0 - 12);
	context.lineTo(0 + 62, 0 - 12);
	context.lineTo(0 + 66, 0 - 16);
	context.lineTo(0 + 69, 0 - 13);
	context.lineTo(0 + 64, 0 - 9);
	context.lineTo(0 + 56, 0 - 6);
	context.lineTo(0 + 60, 0 + 3);
	context.lineTo(0 + 57, 0 + 3);
	context.lineTo(0 + 50, 0 - 5);
	context.lineTo(0 + 8, 0 + 10);
	context.closePath();
	context.fill();
	context.lineWidth = 2;
	context.strokeStyle = "#AAAAAA";
	context.beginPath();
	context.moveTo(0 - 6 - Math.cos(frame * 3 * copter.rotorSpeed) * 40, 0 - 18);
	context.lineTo(0 - 6 + Math.cos(frame * 3 * copter.rotorSpeed) * 40, 0 - 18);
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(66 - 10 * Math.cos(frame * 4 * copter.rotorSpeed), 0 - 13 - 10 * Math.sin(frame * 4 * copter.rotorSpeed));
	context.lineTo(66 + 10 * Math.cos(frame * 4 * copter.rotorSpeed), 0 - 13 + 10 * Math.sin(frame * 4 * copter.rotorSpeed));
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(0 - 21, 0 + 10);
	context.lineTo(0 - 23, 0 + 16);
	context.lineTo(0 - 29, 0 + 15);
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(0 - 23, 0 + 16);
	context.lineTo(0 + 8, 0 + 16);
	context.lineTo(0 + 9, 0 + 10);
	context.stroke();
	context.closePath();
	context.beginPath();
	context.moveTo(0 + 8, 0 + 16);
	context.lineTo(0 + 24, 0 + 10);
	context.stroke();
	context.closePath();
	context.strokeStyle = "#000000";
	context.lineWidth = 0.25;
	context.beginPath();
	context.moveTo(0 - 26, 0 - 6);
	context.lineTo(0 - 30, 0 + 2);
	context.lineTo(0 - 25, 0 + 2);
	context.lineTo(0 - 23, 0 - 6);
	context.closePath();
	context.stroke();
	context.beginPath();
	context.moveTo(0 - 20, 0 - 6);
	context.lineTo(0 - 22, 0 + 2);
	context.lineTo(0 - 18, 0 + 2);
	context.lineTo(0 - 17, 0 - 6);
	context.closePath();
	context.stroke();
	context.beginPath();
	context.moveTo(0 - 12, 0 - 6);
	context.lineTo(0 - 14, 0 + 2);
	context.lineTo(0 - 5, 0 - 2);
	context.lineTo(0 - 5, 0 - 6);
	context.closePath();
	context.stroke();	
	context.fillStyle = "#333333";
	context.beginPath();
	context.moveTo(0 - 13, 0 - 6);
	context.lineTo(0 - 17, 0 + 8);
	context.lineTo(0 - 4, 0 + 8);
	context.lineTo(0 - 3, 0 - 6);
	context.closePath();
	if((copter.y < 310) || (copter.shootDownFrame > 0)) context.stroke();
	else context.fill();
	context.restore();
	context.lineWidth = oldlw;
}

function DrawBomb()
{
	if(bomb.ready) return;
	var bombX = bomb.x - scrollX;
	var gradient = context.createLinearGradient(0, bomb.y - 5, 0, bomb.y + 5);
	gradient.addColorStop(0, "rgb(128, 0, 0)");
	gradient.addColorStop(0.5, "rgb(202, 64, 96)");
	gradient.addColorStop(1, "rgb(128, 0, 0)");
	context.fillStyle = gradient;
	context.beginPath();
	context.moveTo(bombX - 12, bomb.y);
	context.lineTo(bombX - 12 + 4, bomb.y - 4);
	context.lineTo(bombX + 2, bomb.y - 4);
	context.lineTo(bombX + 5, bomb.y - 1);
	context.lineTo(bombX + 8, bomb.y - 4);
	context.lineTo(bombX + 9, bomb.y - 4);
	context.lineTo(bombX + 9, bomb.y + 4);
	context.lineTo(bombX + 8, bomb.y + 4);
	context.lineTo(bombX + 5, bomb.y + 1);
	context.lineTo(bombX + 2, bomb.y + 4);
	context.lineTo(bombX - 12 + 4, bomb.y + 4);
	context.closePath();
	context.fill();
}

function DrawParticles()
{
	for(var i = 0; i < 200; i++)
	{
		if(particle[i].deathFrame > frame)
		{
			context.fillStyle = particle[i].color;
			context.fillRect(particle[i].x - scrollX - 1, particle[i].y - 1, 2, 2);
		}
	}
}

function Draw()
{
	DrawSky();
	DrawGround();
	DrawMountain();
	DrawBuildings();
	DrawTanks();
	DrawBalloon();
	DrawMissile();
	DrawPlane();	
	DrawCopterBullets();
	DrawTankBullets();
	DrawCopter();
	DrawPeople();
	DrawBomb();
	DrawParticles();
	if(state == 0)
	{
		context.fillStyle = "#FFFFFF";
		context.font = "36px Arial";
		context.fillText("Click to start", 170, 145);
	}
	if(state == 2)
	{
		context.fillStyle = "#FFFFFF";
		context.font = "12px Arial";
		context.fillText(("LIVES Extra: " + lives + " HOSTAGES Aboard: " + peopleAboard + " Rescued: " + rescuedPeople + " Dead: " + deadPeople), 0, 12);
	}
	if(state == 3)
	{
		context.fillStyle = "#FFFFFF";
		context.font = "36px Arial";
		context.fillText("Game over", 170, 145);
		context.font = "12px Arial";
		if(gameOverCause == 1) context.fillText("Your helicopter was shot down before you could rescue the hostages. Try again!", 170, 220);
		if(gameOverCause == 2) context.fillText("You did a good job, but some hostages were killed. Try again!", 170, 220);
		if(gameOverCause == 3) context.fillText("Congratulations! Thanks to you, all hostages were rescued with no fatalities!", 170, 220);
	}
}
		</script>
	</head>
	<body onload="Start(); CanvasClick();">
			<canvas style="margin: none; padding: none; top: 0px; left: 0px;" id="screenCanvas" width="640" height="400">
			</canvas>
	</body>
</html>